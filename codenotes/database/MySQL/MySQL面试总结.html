<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://www.codepit.tech/mynotes/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html"><meta property="og:site_name" content="Zuooの学习笔记"><meta property="og:title" content="MySQL面试总结"><meta property="og:description" content="1、索引 mysql索引的种类： 主键索引：Primary Key; 唯一索引：Unique Key; 全文索引：Fulltext Key; 组合索引：多个列值联合; 普通索引：Index; 聚簇索引&&非聚簇索引： 聚簇索引的叶子节点保留了数据行，而非聚簇索引叶子节点储存的是指向数据行的地址 主键索引就是聚簇索引 MyISAM的B+树主键索引和辅助索..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-04-23T14:00:21.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="MySQL"><meta property="article:modified_time" content="2023-04-23T14:00:21.000Z"><link rel="icon" href="/favicon.svg"><title>MySQL面试总结 | Zuooの学习笔记</title><meta name="description" content="1、索引 mysql索引的种类： 主键索引：Primary Key; 唯一索引：Unique Key; 全文索引：Fulltext Key; 组合索引：多个列值联合; 普通索引：Index; 聚簇索引&&非聚簇索引： 聚簇索引的叶子节点保留了数据行，而非聚簇索引叶子节点储存的是指向数据行的地址 主键索引就是聚簇索引 MyISAM的B+树主键索引和辅助索...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/mynotes/assets/style.832a3597.css" as="style" /><link rel="stylesheet" href="/mynotes/assets/style.832a3597.css" />
    <link rel="modulepreload" href="/mynotes/assets/app.e5b261e7.js"><link rel="modulepreload" href="/mynotes/assets/MySQL面试总结.html.1436543c.js"><link rel="modulepreload" href="/mynotes/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/mynotes/assets/MySQL面试总结.html.8a01e007.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/mynotes/" class="brand"><img class="logo" src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/avatar.jpeg" alt="Zuooの学习笔记"><!----><span class="site-name hide-in-pad">Zuooの学习笔记</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/mynotes/quicknav/" class="nav-link" aria-label="快速导航"><span class="icon iconfont icon-navigation"></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/codenotes/" class="nav-link active" aria-label="代码笔记"><span class="icon iconfont icon-code"></span>代码笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/projects/" class="nav-link" aria-label="开源项目"><span class="icon iconfont icon-free"></span>开源项目<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="资源宝库"><span class="title"><span class="icon iconfont icon-advance"></span>资源宝库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/mynotes/resources/books/" class="nav-link" aria-label="书籍资源"><span class="icon iconfont icon-animation"></span>书籍资源<!----></a></li><li class="dropdown-item"><a href="/mynotes/resources/videos/" class="nav-link" aria-label="影音资源"><span class="icon iconfont icon-play"></span>影音资源<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Echoidf/mynotes.git" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java核心</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Spring</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-engine"></span><span class="title">Java虚拟机</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-frame"></span><span class="title">企业级框架</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">数据库</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-workingDirectory"></span><span class="title">MySQL</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/mynotes/codenotes/database/MySQL/Ubuntu%E5%AE%89%E8%A3%85mysql.html" class="nav-link sidebar-link sidebar-page" aria-label="Ubuntu安装Mysql"><span class="icon iconfont icon-workingDirectory"></span>Ubuntu安装Mysql<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/MySQL/MySQL%E8%87%AA%E5%A2%9EID%E8%B7%B3%E8%B7%83%E9%97%AE%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL自增ID跳跃问题"><span class="icon iconfont icon-storage"></span>MySQL自增ID跳跃问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="MySQL面试总结"><span class="icon iconfont icon-storage"></span>MySQL面试总结<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_1、索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1、索引"><!---->1、索引<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#mysql索引的种类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="mysql索引的种类："><!---->mysql索引的种类：<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#聚簇索引-非聚簇索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="聚簇索引&amp;&amp;非聚簇索引："><!---->聚簇索引&amp;&amp;非聚簇索引：<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#b树和b-树" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="B树和B+树"><!---->B树和B+树<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#什么时候会索引失效全表扫描" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="什么时候会索引失效全表扫描？"><!---->什么时候会索引失效全表扫描？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#场景题1-where-a-1-and-b-1-order-by-c-如何建立索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="场景题1：WHERE a &gt; 1 and b=1 ORDER BY c 如何建立索引"><!---->场景题1：WHERE a &gt; 1 and b=1 ORDER BY c 如何建立索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#场景题2-比较效率count-1-、count-、count-主键-、count-字段" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="场景题2：比较效率COUNT(1)、COUNT(*)、COUNT(主键)、COUNT(字段)"><!---->场景题2：比较效率COUNT(1)、COUNT(*)、COUNT(主键)、COUNT(字段)<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_2、事务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2、事务"><!---->2、事务<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_3、分布式锁" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3、分布式锁"><!---->3、分布式锁<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#乐观锁" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="乐观锁"><!---->乐观锁<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#悲观锁" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="悲观锁"><!---->悲观锁<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_4、主从复制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4、主从复制"><!---->4、主从复制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_5、分库分表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5、分库分表"><!---->5、分库分表<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_6、慢查询" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6、慢查询"><!---->6、慢查询<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_7、三大日志" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7、三大日志"><!---->7、三大日志<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_1-binlog" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.binlog"><!---->1.binlog<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_2-redo-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.redo log"><!---->2.redo log<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_3-undo-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.undo log"><!---->3.undo log<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_4-二阶段提交原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.二阶段提交原理"><!---->4.二阶段提交原理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_8、数据文件种类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8、数据文件种类"><!---->8、数据文件种类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_9、mvcc机制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9、MVCC机制"><!---->9、MVCC机制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_10、join语句" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10、JOIN语句"><!---->10、JOIN语句<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#inner-join-内连接" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="INNER JOIN 内连接"><!---->INNER JOIN 内连接<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#outer-join-外连接" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="OUTER JOIN 外连接"><!---->OUTER JOIN 外连接<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_11、innodb和myisam引擎区别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11、Innodb和MyISAM引擎区别"><!---->11、Innodb和MyISAM引擎区别<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_12、数据库范式-函数依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12、数据库范式&amp;函数依赖"><!---->12、数据库范式&amp;函数依赖<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">算法和数据结构</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">云计算</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-docker"></span><span class="title">Docker</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">GraphQL</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">web</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-read"></span><span class="title">优质站点推荐</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-storage"></span>MySQL面试总结</h1><div class="page-info"><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category3 clickable" role="navigation">MySQL</span></li></ul><meta property="articleSection" content="MySQL"></span><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag3 clickable" role="navigation">MySQL</span></li></ul><meta property="keywords" content="MySQL"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_1、索引" class="router-link-active router-link-exact-active toc-link level2">1、索引</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#mysql索引的种类" class="router-link-active router-link-exact-active toc-link level3">mysql索引的种类：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#聚簇索引-非聚簇索引" class="router-link-active router-link-exact-active toc-link level3">聚簇索引&amp;&amp;非聚簇索引：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#b树和b-树" class="router-link-active router-link-exact-active toc-link level3">B树和B+树</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#什么时候会索引失效全表扫描" class="router-link-active router-link-exact-active toc-link level3">什么时候会索引失效全表扫描？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#场景题1-where-a-1-and-b-1-order-by-c-如何建立索引" class="router-link-active router-link-exact-active toc-link level3">场景题1：WHERE a &gt; 1 and b=1 ORDER BY c 如何建立索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#场景题2-比较效率count-1-、count-、count-主键-、count-字段" class="router-link-active router-link-exact-active toc-link level3">场景题2：比较效率COUNT(1)、COUNT(*)、COUNT(主键)、COUNT(字段)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_2、事务" class="router-link-active router-link-exact-active toc-link level2">2、事务</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_3、分布式锁" class="router-link-active router-link-exact-active toc-link level2">3、分布式锁</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#乐观锁" class="router-link-active router-link-exact-active toc-link level3">乐观锁</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#悲观锁" class="router-link-active router-link-exact-active toc-link level3">悲观锁</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_4、主从复制" class="router-link-active router-link-exact-active toc-link level2">4、主从复制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_5、分库分表" class="router-link-active router-link-exact-active toc-link level2">5、分库分表</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_6、慢查询" class="router-link-active router-link-exact-active toc-link level2">6、慢查询</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_7、三大日志" class="router-link-active router-link-exact-active toc-link level2">7、三大日志</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_1-binlog" class="router-link-active router-link-exact-active toc-link level3">1.binlog</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_2-redo-log" class="router-link-active router-link-exact-active toc-link level3">2.redo log</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_3-undo-log" class="router-link-active router-link-exact-active toc-link level3">3.undo log</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_4-二阶段提交原理" class="router-link-active router-link-exact-active toc-link level3">4.二阶段提交原理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_8、数据文件种类" class="router-link-active router-link-exact-active toc-link level2">8、数据文件种类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_9、mvcc机制" class="router-link-active router-link-exact-active toc-link level2">9、MVCC机制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_10、join语句" class="router-link-active router-link-exact-active toc-link level2">10、JOIN语句</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#inner-join-内连接" class="router-link-active router-link-exact-active toc-link level3">INNER JOIN 内连接</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#outer-join-外连接" class="router-link-active router-link-exact-active toc-link level3">OUTER JOIN 外连接</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_11、innodb和myisam引擎区别" class="router-link-active router-link-exact-active toc-link level2">11、Innodb和MyISAM引擎区别</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/MySQL/MySQL%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html#_12、数据库范式-函数依赖" class="router-link-active router-link-exact-active toc-link level2">12、数据库范式&amp;函数依赖</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="_1、索引" tabindex="-1"><a class="header-anchor" href="#_1、索引" aria-hidden="true">#</a> 1、索引</h2><h3 id="mysql索引的种类" tabindex="-1"><a class="header-anchor" href="#mysql索引的种类" aria-hidden="true">#</a> mysql索引的种类：</h3><ul><li>主键索引：Primary Key</li><li>唯一索引：Unique Key</li><li>全文索引：Fulltext Key</li><li>组合索引：多个列值联合</li><li>普通索引：Index</li></ul><h3 id="聚簇索引-非聚簇索引" tabindex="-1"><a class="header-anchor" href="#聚簇索引-非聚簇索引" aria-hidden="true">#</a> 聚簇索引&amp;&amp;非聚簇索引：</h3><p>聚簇索引的叶子节点保留了数据行，而非聚簇索引叶子节点储存的是指向数据行的地址</p><p>主键索引就是聚簇索引</p><p>MyISAM的B+树主键索引和辅助索引的叶子节点都是数据文件的地址指针——非聚簇索引</p><h3 id="b树和b-树" tabindex="-1"><a class="header-anchor" href="#b树和b-树" aria-hidden="true">#</a> B树和B+树</h3><p>MySQL索引使用的是B+树结构，是一种磁盘友好的数据结构。它的叉的数量是可以指定的，Mysql中大约是1170，一个结点可以储存多个元素，相较于B树而言，B树节点之间是不存在重复元素的，B+树每一个父节点元素都是子节点的最大或最小元素，并且所有的叶子节点形成了一个有序的链表，从而支持范围查询。</p><ul><li>B树的每个节点都存储了key和data，而B+树的data存储在叶子节点上。</li><li><strong>B+树非叶子节点仅存储key不存储data，这样一个节点（数据页）就可以存储更多的key，可以使得B+树相对B树来说更矮（IO次数就是树的高度），所以与磁盘交换的IO操作次数更少。</strong></li><li>B+树所有叶子节点构成一个 <em>有序链表</em>，按主键排序来遍历全部记录，能更好支持<strong>范围查找</strong>。由于数据顺序排列并且相连，所以便于区间查找和搜索。而B树则需要进行每一层的递归遍历，相邻的元素可能在内存中不相邻，所以缓存命中性没有B+树好。</li><li>B+树所有的查询都要从根节点查找到叶子节点，<strong>查询性更稳定</strong>；而B树，每个节点都可能查找到数据，需要在叶子节点和内部节点不停的往返移动，所以不稳定。</li></ul><h3 id="什么时候会索引失效全表扫描" tabindex="-1"><a class="header-anchor" href="#什么时候会索引失效全表扫描" aria-hidden="true">#</a> 什么时候会索引失效全表扫描？</h3><ol><li>查询条件中带有 where...or...，除非所有条件字段都加了索引，否则就会全表扫描</li><li>模糊查询时where...like &#39;%xx&#39; 此时索引也会失效</li><li>索引列参与计算时会失效</li><li>违背最左匹配原则</li></ol><h3 id="场景题1-where-a-1-and-b-1-order-by-c-如何建立索引" tabindex="-1"><a class="header-anchor" href="#场景题1-where-a-1-and-b-1-order-by-c-如何建立索引" aria-hidden="true">#</a> 场景题1：WHERE a &gt; 1 and b=1 ORDER BY c 如何建立索引</h3><p>可以建立联合索引，但是考虑到最左匹配原则，不能把a作为联合索引第一个，因为最左匹配原则是在前一个有序的情况下，才能走到后面的索引查询，而这里不确定a到底是2还是3还是什么，会导致索引失效。</p><p>如果c建立索引也会导致索引失效，因为有order by函数。</p><p>所以我选择(b,a)建立索引。</p><h3 id="场景题2-比较效率count-1-、count-、count-主键-、count-字段" tabindex="-1"><a class="header-anchor" href="#场景题2-比较效率count-1-、count-、count-主键-、count-字段" aria-hidden="true">#</a> 场景题2：比较效率COUNT(1)、COUNT(*)、COUNT(主键)、COUNT(字段)</h3><p>性能：COUNT(<em>) = COUNT(1) &gt; COUNT(主键字段) &gt; COUNT(字段)</em></p><p><em>COUNT(</em>)的作用是，统计符合条件的记录中，函数指定的参数不为NULL的参数有多少。</p><p>COUNT(1)和COUNT(*)的效率是相同的，都只是统计结果集的行数，而不用对列进行计算和判断，因此效率较高。</p><p>COUNT(主键)的效率较低，在统计主键列需要判断是否存在空值，然后排除空值计算出行数，需要额外的开销。</p><p>COUNT(字段)的效率最低，字段如果不是索引字段，只是普通字段，将会采用全表扫描的方式来计数。</p><h2 id="_2、事务" tabindex="-1"><a class="header-anchor" href="#_2、事务" aria-hidden="true">#</a> 2、事务</h2><p><strong>事务的四个特性：ACID</strong></p><p>原子性、隔离性、一致性、持久性</p><p>事务保证了一系列的操作要么全部成功要么全部失败，一旦事务提交，则其所做的修改会永久保存到数据库。</p><p><strong>事务隔离级别</strong></p><p>MySQL默认隔离级别是可重复读，可以避免脏读和不可重复读，可能会幻读</p><p>脏读和不可重复读的区别就是后者读到的是<strong>已提交</strong>的数据</p><p>幻读就是一个事务读取了某些记录，另一个事务又进行了<strong>插入或者删除</strong>操作，这种事务是没办法用行级锁来解决的</p><p>有四种隔离级别：读未提交、读已提交、可重复读、串行化</p><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214646.png" alt="image.png"></p><p><strong>关于记录锁/间隙锁</strong></p><p>在可重复读的隔离级别下，对一行数据进行查询或者更新都会加记录锁** record lock**</p><p>间隙锁 <strong>Gap Lock</strong>是为了解决幻读的，也是行锁的一种。它会锁住两个值之间的空隙【两边都是开区间】，当另一个事务去对这个锁住的间隙进行插入数据的时候就会阻塞，从而解决幻读的问题。间隙锁也是只在可重复读的级别下生效。</p><p>默认情况下间隙锁是开启的，<code>innodb_locks_unsafe_for_binlog</code>参数值默认是OFF，代表开启间隙锁</p><p>记录锁与行锁的组合：<strong>Next key Lock【前开后闭区间】Innodb在扫描索引记录的时候会先加record lock，再对索引记录两边的间隙加上Gap lock</strong></p><p><strong>什么情况下会产生next-key lock?</strong></p><ol><li><strong>对于唯一索引</strong></li></ol><p>测试表记录：<img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214800.png" alt=""></p><ul><li>当查询单条记录的时候只会产生Record lock</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>当查询不存在的记录的时候会产生next-key lock【容易产生死锁】</li></ul><p>间隙区间：向左扫描到第一个比给定参数小的值，向右扫描扫描到第一个比给定参数大的值，前开后闭</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 事务1</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- 防止锁超时自动释放</span>
<span class="token keyword">SELECT</span> sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>  <span class="token comment">## 先不提交事务1</span>


<span class="token comment">-- 事务2</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&#39;hka&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">## 会阻塞</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个案例中由于delete语句是删除不存在的数据，也会产生间隙锁，区间是（3，6]<code>&lt;br /&gt;</code>所以事务2进行插入的时候就会阻塞，只有当事务1提交事务锁释放之后才能插入成功</p><ul><li>当进行范围查询的时候会产生next-key lock</li></ul><p><strong>事务隔离级别是如何实现的？</strong></p><p>在访问数据库数据时，其实数据库会创建一个视图/快照，读未提交不会创建视图的，直接返回最新值，读已提交是在每个sql语句执行之前创建视图，可重复读是在事务开始之前创建视图，可序列化是直接加锁来实现。</p><p>可重复读的核心是一致性读，<strong>事务更新数据的时候只能使用当前读</strong>，不使用快照读，如果当前记录的行锁被其他事务占用就要进行锁等待。</p><p>要保证事务的原子性，就要通过undo log和MVCC机制，每个数据在MySQL中其实是有多个版本的，在更新一条记录的时候就会记录一条回滚日志，通过回滚可以得到前一个状态的值。这里的版本就是row trx_id。</p><h2 id="_3、分布式锁" tabindex="-1"><a class="header-anchor" href="#_3、分布式锁" aria-hidden="true">#</a> 3、分布式锁</h2><p>用MySQl实现分布式锁的思想比较简单，就是加一张锁表，获得锁的时候就新增一条记录，释放锁就删除这条记录。这种方式基于数据库IO操作，比较低效，也存在着一些问题。</p><h3 id="乐观锁" tabindex="-1"><a class="header-anchor" href="#乐观锁" aria-hidden="true">#</a> 乐观锁</h3><p>乐观锁大多是基于版本号机制来实现的。就是在数据表上增加一个version字段。更新数据后同时也将这个version加1，如果有多个线程并发修改一条记录，通过比较前后的版本号（在sql里加一个where条件）就可以判断是否要进行更新操作。</p><p>优点是不会影响请求的性能，但是并发写是有可能出现数据不一致的，适合读多写少的情景。高并发情况下出现严重的空自旋问题。</p><h3 id="悲观锁" tabindex="-1"><a class="header-anchor" href="#悲观锁" aria-hidden="true">#</a> 悲观锁</h3><p>悲观锁也叫排它锁/写锁。操作数据的时候其他事务只能等待，阻塞请求，最大程度上保证了数据的一致性，但是容易导致锁超时、并发程度低甚至是死锁。适合写入操作比较频繁的场景。</p><p>实现悲观锁需要关掉Mysql的自动提交，开启事务</p><p>MySQL的insert 、update、delete语句会自动加上行锁（前提是要有索引，因为行锁是锁在索引上的）</p><h2 id="_4、主从复制" tabindex="-1"><a class="header-anchor" href="#_4、主从复制" aria-hidden="true">#</a> 4、主从复制</h2><p>主要是为了缓解单一数据库的压力，mysql在事务提交的时候会把数据变更作为事件events记录到binlog二进制文件中，从库通过读取binlog进行数据同步。</p><p>原理是通过三个线程来实现数据同步，主库转储线程会在从库线程连接的时候将这个binlog日志发送给它，从库IO线程负责读取binlog日志并拷贝到中继日志relay log，还有一个sql线程负责从relay log执行日志中的事件</p><p>一般是主库用来写，从库用来读。</p><p>怎么降低主从延迟呢？</p><p>mysql5.6版本以后提供了并行复制的功能，可以将sql线程转换为多个woker线程并行复制</p><h2 id="_5、分库分表" tabindex="-1"><a class="header-anchor" href="#_5、分库分表" aria-hidden="true">#</a> 5、分库分表</h2><p>有两种数据拆分方式：</p><ul><li>垂直拆分：字段太多，按照字段进行拆分</li><li>水平拆分：字段比较少，但是单条记录很大，将表/库拆分，但是结构不变</li></ul><p>可以按照哈希算法或者根据时间来进行分片。</p><p>分库分表后主要牵扯到的就是如何解决分布式事务问题--2PC 3PC XA协议</p><p>主要解决方案是使用Mycat、ShardingJDBC</p><h2 id="_6、慢查询" tabindex="-1"><a class="header-anchor" href="#_6、慢查询" aria-hidden="true">#</a> 6、慢查询</h2><p>慢查询就是超过了long_query_time（默认10秒）时间阈值。</p><p>慢查询日志默认是不开启的，可以通过命令 <code>set global slow_query_log=&#39;ON&#39;</code>来开启，通过 <code>set global long_query_time=1</code>来指定时间阈值，windows在my.ini文件中修改即可 <code>&lt;br /&gt;</code>如何优化？</p><ol><li>**优化limit分页，**当偏移量很大的时候会很慢</li></ol><p>查询字段比较少的时候可以构造联合索引，避免全表扫描</p><ol start="2"><li><strong>优化offset</strong></li></ol><p>利用自增主键有序的特性，比如现在要对以下sql进行优化：</p><p><code>SELECT * from xx LIMIT 1000000,10;</code></p><p>可以修改为这样：</p><p><code>SELECT * from xx where id &gt;=(SELECT id from xx ORDER BY id limit 1000000,1) limit 10;</code></p><ol start="3"><li><strong>延迟关联</strong></li></ol><p>先查出要查的记录的id，再通过覆盖索引二次查询到该页的数据</p><p><code>SELECT * from xx inner join (SELECT id from xx order by id limit 1000000,10) as myNew using(id);</code></p><ol start="4"><li>使用EXPLAIN命令查看sql执行情况，是否是全表扫描，如果有需要可以添加索引</li><li>尽可能避免使用子查询，使用合适的JOIN语句</li><li>对于需要复杂计算的查询，可以使用数据库缓存，将计算结果缓存到内存中避免重复计算</li><li>对于高并发的查询，可以考虑使用数据库的读写分离、分库分表等技术，以提高数据库的并发处理能力</li></ol><h2 id="_7、三大日志" tabindex="-1"><a class="header-anchor" href="#_7、三大日志" aria-hidden="true">#</a> 7、三大日志</h2><h3 id="_1-binlog" tabindex="-1"><a class="header-anchor" href="#_1-binlog" aria-hidden="true">#</a> 1.binlog</h3><p>用于记录数据库执行的写入性操作(不包括查询)信息【逻辑日志sql语句】，以<strong>二进制</strong>的形式保存在磁盘中。任何引擎都会进行记录。</p><p><strong>事务提交时会记录binlog。</strong></p><p>mysql通过<strong>sync_binlog</strong>参数控制biglog的持久化时机，取值范围是0-N：</p><ul><li>0：不去强制要求，由系统自行判断何时写入磁盘；</li><li>1：每次commit的时候都要将binlog写入磁盘；</li><li>N：每N个事务，才会将binlog写入磁盘。</li></ul><p>从上面可以看出，sync_binlog最安全的是设置是1，这也是MySQL 5.7.7之后版本的默认值。但是设置一个大一些的值可以提升数据库性能，因此实际情况下也可以将值适当调大，牺牲一定的一致性来获取更好的性能。</p><p>日志格式：</p><ol><li>statement</li></ol><p>基于语句模式：每一条修改都会进行记录，记录的是sql语句，从库可以根据sql语句进行复现，但是这种格式有<strong>动态函数</strong>的问题，比如使用了uuid或者now这种函数，在主库上执行的结果会和从库不一样</p><ol start="2"><li>row</li></ol><p>基于数据行模式：记录的是行数据最终被修改成什么样子了，它没有动态函数的问题，但是由于每行数据的变化结果都会记录，如果执行过批量处理，binlog文件很<strong>容易变得很大</strong></p><ol start="3"><li>mixed</li></ol><p>混合模式：包括了statement和row模式，会根据不同情况自动使用row模式和statement模式</p><p>MySQL5.7版本之前默认格式为Statement，5.7开始默认格式为ROW，可以确保在数据复制和恢复的时候更加精确和一致。配置参数为：<code>binlog_format</code></p><p>查看参数：<code>show variables like &#39;binlog_format&#39;</code></p><h3 id="_2-redo-log" tabindex="-1"><a class="header-anchor" href="#_2-redo-log" aria-hidden="true">#</a> 2.redo log</h3><p><strong>数据库逻辑的变更日志</strong></p><p>Innodb引擎特有的。Innodb是以页为单位和磁盘进行交互，而一个事务可能只修改一页中的几个字节，如果全部刷新比较浪费资源，如果涉及到多个数据页，因为这些数据页在物理上是不连续的，使用随机IO写入的性能很差。</p><p>redo log会记录事务对数据页做了哪些修改，相当于一个归档。</p><p><em><strong>redo log</strong>大小是固定的，采用了循环写入的方式，适用于崩溃恢复crash-safe</em></p><h3 id="_3-undo-log" tabindex="-1"><a class="header-anchor" href="#_3-undo-log" aria-hidden="true">#</a> 3.undo log</h3><p>undo log保证了事务四大特性之一的原子性，记录了数据的逻辑变化，比如一条insert语句就对应着一条逻辑相反的delete语句，这样在发生错误的时候就可以进行回滚</p><h3 id="_4-二阶段提交原理" tabindex="-1"><a class="header-anchor" href="#_4-二阶段提交原理" aria-hidden="true">#</a> 4.二阶段提交原理</h3><p>如果Mysql开启了binlog日志，在事务提交时需要同时完成binlog和redolog的事务写入。</p><p>MySQL的二阶段提交发生在binlog和redolog的日志写入阶段，目的是确保redolog和binlog写入的数据一致性：</p><ul><li>prepare阶段</li></ul><p>MySQL将事务操作记录到redolog中并标记为prepare状态</p><ul><li>commit阶段</li></ul><p>事务提交时Mysql将事务操作记录到binlog，然后将redolog中的日志设置为commit状态</p><p>如果在写入redo log之前崩溃，此时两个日志都没有记录，符合一致性</p><p>如果在写入redo log prepare阶段后立刻崩溃，在做崩溃恢复时，根据redolog的事务id去binlog中是无法查找到的，因为redolog没有被设置为commit状态，此时就会进行回滚</p><h2 id="_8、数据文件种类" tabindex="-1"><a class="header-anchor" href="#_8、数据文件种类" aria-hidden="true">#</a> 8、数据文件种类</h2><p>在MySQL数据管理中，数据文件主要分为以下几种：</p><ol><li>表结构文件：该文件存储数据库中表的元数据信息，比如表名、列名、数据类型、索引等信息。</li><li>数据文件：该文件存储表的实际数据。</li><li>日志文件：MySQL使用日志文件来记录对数据库中数据的修改操作，以便在需要时进行回滚或恢复操作。</li><li>临时文件：当进行一些复杂的查询或排序等操作时，MySQL可能会生成一些临时文件来辅助完成这些操作，这些临时文件通常存储在临时目录下。</li><li>锁文件：MySQL使用锁文件来控制多个并发操作之间的访问顺序和互斥性。</li><li>索引文件：该文件用于存储表中的索引信息，加快数据的检索速度。</li></ol><h2 id="_9、mvcc机制" tabindex="-1"><a class="header-anchor" href="#_9、mvcc机制" aria-hidden="true">#</a> 9、MVCC机制</h2><p>InnoDB 里面每个事务有一个唯一的事务 ID，叫作 transaction id。它是在事务开始的时候向 InnoDB 的事务系统申请的，是按申请顺序严格递增的。</p><p>而每行数据也都是有多个版本的。每次事务更新数据的时候，都会生成一个新的数据版本，并且把 transaction id 赋值给这个数据版本的事务 ID，记为 row trx_id。同时，旧的数据版本要保留，并且在新的数据版本中，能够有信息可以直接拿到它。</p><p>也就是说，数据表中的一行记录，其实可能有多个版本 (row)，每个版本有自己的 row trx_id。<code>&lt;br /&gt;</code>MVCC（Multi-Version Concurrency Control）即<strong>多版本并发控制</strong>，是MySQL数据库中实现并发访问控制的一种机制。 读操作只读该事务开始前的数据库的快照（复制了一份数据）。这样在读操作不用阻塞写操作，写操作不用阻塞读操作的同时，避免了脏读和不可重复读。</p><p>MVCC机制在写数据之前会先将数据复制一份，从而创建一个新的快照--**写时复制技术 。**当一个事务需要修改数据时，MVCC会首先检查修改数据的快照版本号是否与该事务的快照版本号一致，如果一致就说明可以修改，否则这个事务需要等待其他事务完成对该数据的修改。另外，这个事务在新快照上修改的结果不会影响原始数据，其他事务可以继续读取原始数据的快照，从而解决脏读和不可重复读问题。</p><p>作用：在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数 据库并发读写的性能。同时还可以解决脏读、幻读、不可重复读等事务隔离问题，但不能解决更新丢失问题。</p><p>实现原理： 它的实现原理主要是依赖记录中的 3 个隐式字段、undo 日志、Read View 来实现的。</p><p><strong>表的隐藏列：</strong></p><table><thead><tr><th>DB_TRX_ID</th><th>记录操作该数据事务的事务ID；</th></tr></thead><tbody><tr><td>DB_ROLL_PTR</td><td>指向上一个版本数据在undo log 里的位置指针；</td></tr><tr><td>DB_ROW_ID:</td><td>隐藏ID ，当创建表没有合适的索引作为聚集索引时，会用该隐藏ID创建聚集索引;</td></tr></tbody></table><p><strong>undolog日志：</strong></p><ul><li>保证事务进行rollback时的原子性和一致性，当事务进行回滚的时候可以用undo log的数据进行恢复。</li><li>用于MVCC快照读的数据，在MVCC多版本控制中，通过读取undo log的历史版本数据可以实现<strong>不同事务版本号都拥有自己独立的快照数据版本。</strong></li></ul><p><strong>Read View：</strong></p><p>在innodb 中每个事务开启后都会得到一个read_view。副本主要保存了当前数据库系统中正处于活跃（没有commit）的事务的ID号，其实简单的说这个副本中保存的是系统中当前不应该被本事务看到的其他事务id列表。</p><p><em>InnoDB 为</em><strong><em>每个事务</em></strong><em>构造了一个</em><strong><em>数组</em></strong><em>，用来保存这个事务启动瞬间，</em><strong><em>当前正在“活跃”的所有事务 ID</em></strong><em>。“活跃”指的就是，启动了但还没提交。</em></p><p><em>数组里面事务 ID 的最小值记为低水位，当前系统里面已经创建过的事务 ID 的最大值加 1 记为高水位。</em></p><p><em>这个视图数组和高水位，就组成了</em><strong><em>当前事务的一致性视图（read-view）</em></strong><em>。</em></p><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214826.png" alt="img"></p><h2 id="_10、join语句" tabindex="-1"><a class="header-anchor" href="#_10、join语句" aria-hidden="true">#</a> 10、JOIN语句</h2><p>MySQL的Join语句用于连接两个或多个表，以便在结果集中检索数据。</p><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214846.png" alt="img"></p><h3 id="inner-join-内连接" tabindex="-1"><a class="header-anchor" href="#inner-join-内连接" aria-hidden="true">#</a> INNER JOIN 内连接</h3><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214901.png" alt="img"></p><p>CROSS JOIN 交叉连接 返回两个表的笛卡儿积，后面没有ON条件</p><h3 id="outer-join-外连接" tabindex="-1"><a class="header-anchor" href="#outer-join-外连接" aria-hidden="true">#</a> OUTER JOIN 外连接</h3><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214921.png" alt=""></p><ol><li>LEFT JOIN</li></ol><p><em>左连接查询会返回左表中的所有记录，若左表的记录没有和右表匹配就会显示空值。</em></p><ol start="2"><li>RIGHT JOIN</li></ol><p><em>和 LEFT JOIN 相反</em></p><ol start="3"><li>FULL JOIN <em>全连接</em></li></ol><p><img src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/20230423214937.png" alt=""></p><h2 id="_11、innodb和myisam引擎区别" tabindex="-1"><a class="header-anchor" href="#_11、innodb和myisam引擎区别" aria-hidden="true">#</a> 11、Innodb和MyISAM引擎区别</h2><ol><li>事务支持：InnoDB支持事务，而MyISAM不支持。这意味着使用InnoDB可以实现更可靠的数据处理，因为它具有ACID属性（原子性、一致性、隔离性和持久性）。</li><li>并发处理：InnoDB支持行级锁定，因此多个并发用户可以同时读取和写入不同的行，而不会阻塞彼此。MyISAM则只支持表级锁定，这意味着同时只能有一个用户访问整个表。</li><li>外键支持：InnoDB支持外键约束，MyISAM不支持。外键约束可以确保数据的完整性和一致性。</li><li>全文搜索：MyISAM比InnoDB更适合进行全文搜索，因为它支持全文索引。</li><li>索引：InnoDB在处理大量数据时比MyISAM效率更高，因为它使用了更复杂的B+Tree索引结构，可以更快地查找数据。</li></ol><p>综上所述，如果需要事务支持、并发处理或外键约束等功能，则应选择InnoDB存储引擎。但如果需要进行全文搜索或需要处理较小的数据集，则可能更适合使用MyISAM存储引擎。</p><h2 id="_12、数据库范式-函数依赖" tabindex="-1"><a class="header-anchor" href="#_12、数据库范式-函数依赖" aria-hidden="true">#</a> 12、数据库范式&amp;函数依赖</h2><blockquote><p>码：表中可以唯一确定一个元组的某个属性（或者属性组），如果这样的码有不止一个，就叫候选码，选定其中某个作为主码 外码：也叫外键，是其他表的码 全码：如果一个码包含了所有的属性就是全码 主属性：包含在任意一个候选码中的属性叫做主属性 元组：表中的一行数据就是元组</p></blockquote><p>第一范式 1NF：属性不可再分</p><p>第二范式 2NF：满足第一范式，且非主属性完全依赖于码</p><pre><code>比如（学生，课程）是一个码，但是课程--&gt;教材，这就是不完全依赖，可以将一张表进行分解
</code></pre><p>第三范式 3NF：满足第二范式，且没有传递函数依赖</p><pre><code>比如（学生，课程）是一个码，{学生，课程}--&gt;老师， 老师--&gt;老师职称，这就是有传递依赖，还是需要进行分解
</code></pre></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/mynotes/codenotes/database/MySQL/MySQL%E8%87%AA%E5%A2%9EID%E8%B7%B3%E8%B7%83%E9%97%AE%E9%A2%98.html" class="nav-link prev" aria-label="MySQL自增ID跳跃问题"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><span class="icon iconfont icon-storage"></span>MySQL自增ID跳跃问题</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/mynotes/assets/app.e5b261e7.js" defer></script>
  </body>
</html>
