<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://www.codepit.tech/mynotes/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html"><meta property="og:site_name" content="Zuooの学习笔记"><meta property="og:title" content="Redis持久化"><meta property="og:description" content="一、官方资料 在线文档 : https://redis.io/topics/persistence (在线文档 : https://redis.io/topics/persistence) RDB (Redis Database): RDB persistence performs point-in-time snapshots of your dat..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-02T03:48:54.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="NoSql"><meta property="article:tag" content="非关系型数据库"><meta property="article:tag" content="高并发"><meta property="article:modified_time" content="2023-02-02T03:48:54.000Z"><link rel="icon" href="/favicon.svg"><title>Redis持久化 | Zuooの学习笔记</title><meta name="description" content="一、官方资料 在线文档 : https://redis.io/topics/persistence (在线文档 : https://redis.io/topics/persistence) RDB (Redis Database): RDB persistence performs point-in-time snapshots of your dat...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/mynotes/assets/style.832a3597.css" as="style" /><link rel="stylesheet" href="/mynotes/assets/style.832a3597.css" />
    <link rel="modulepreload" href="/mynotes/assets/app.072b1c63.js"><link rel="modulepreload" href="/mynotes/assets/Redis持久化.html.798af710.js"><link rel="modulepreload" href="/mynotes/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/mynotes/assets/Redis持久化.html.119c2805.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/mynotes/" class="brand"><img class="logo" src="https://zql-oss1.oss-cn-nanjing.aliyuncs.com/notes/avatar.jpeg" alt="Zuooの学习笔记"><!----><span class="site-name hide-in-pad">Zuooの学习笔记</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/mynotes/quicknav/" class="nav-link" aria-label="快速导航"><span class="icon iconfont icon-navigation"></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/codenotes/" class="nav-link active" aria-label="代码笔记"><span class="icon iconfont icon-code"></span>代码笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mynotes/projects/" class="nav-link" aria-label="开源项目"><span class="icon iconfont icon-free"></span>开源项目<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="资源宝库"><span class="title"><span class="icon iconfont icon-advance"></span>资源宝库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/mynotes/resources/books/" class="nav-link" aria-label="书籍资源"><span class="icon iconfont icon-animation"></span>书籍资源<!----></a></li><li class="dropdown-item"><a href="/mynotes/resources/videos/" class="nav-link" aria-label="影音资源"><span class="icon iconfont icon-play"></span>影音资源<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Echoidf/mynotes.git" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java核心</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-engine"></span><span class="title">Java虚拟机</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-frame"></span><span class="title">企业级框架</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">算法和数据结构</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">数据库</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">MySQL</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/mynotes/codenotes/database/Redis/%E5%AE%89%E8%A3%85%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="redis安装及基本指令"><span class="icon iconfont icon-workingDirectory"></span>redis安装及基本指令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%8C%87%E4%BB%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="五大数据类型和指令"><span class="icon iconfont icon-workingDirectory"></span>五大数据类型和指令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/Redis%E9%85%8D%E7%BD%AE.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis配置"><span class="icon iconfont icon-workingDirectory"></span>Redis配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis发布订阅"><span class="icon iconfont icon-workingDirectory"></span>Redis发布订阅<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redis持久化"><span class="icon iconfont icon-workingDirectory"></span>Redis持久化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#一、官方资料" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="一、官方资料"><!---->一、官方资料<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-rdb-redis-database" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. RDB（Redis DataBase）"><!---->1. RDB（Redis DataBase）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-aof-append-only-file" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.AOF  (Append Only File)"><!---->2.AOF  (Append Only File)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 小结"><!---->3. 小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#二、rdb配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="二、RDB配置"><!---->二、RDB配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-修改默认rdb文件位置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.修改默认rdb文件位置"><!---->1.修改默认rdb文件位置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-默认快照配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.默认快照配置"><!---->2.默认快照配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-相关指令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.相关指令"><!---->3.相关指令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_4-其他配置项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.其他配置项"><!---->4.其他配置项<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_5-rdb备份及恢复" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.RDB备份及恢复"><!---->5.RDB备份及恢复<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_6-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.小结"><!---->6.小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#三、aof" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="三、AOF"><!---->三、AOF<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-持久化流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.持久化流程"><!---->1.持久化流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-开启aof" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.开启AOF"><!---->2.开启AOF<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-aof异常恢复" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.AOF异常恢复"><!---->3.AOF异常恢复<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_4-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.小结"><!---->4.小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/Redis%E4%BA%8B%E5%8A%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis事务"><span class="icon iconfont icon-workingDirectory"></span>Redis事务<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/%E7%81%AB%E8%BD%A6%E6%8A%A2%E7%A5%A8%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="火车抢票并发问题"><span class="icon iconfont icon-workingDirectory"></span>火车抢票并发问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis主从复制"><span class="icon iconfont icon-workingDirectory"></span>Redis主从复制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/mynotes/codenotes/database/Redis/Redis%E7%BC%93%E5%AD%98%E5%BA%94%E7%94%A8%E9%97%AE%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis缓存应用问题"><span class="icon iconfont icon-workingDirectory"></span>Redis缓存应用问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-computer"></span><span class="title">云计算</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">web</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-read"></span><span class="title">优质站点推荐</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-workingDirectory"></span>Redis持久化</h1><div class="page-info"><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category3 clickable" role="navigation">Redis</span></li><li><span class="category category6 clickable" role="navigation">数据库</span></li></ul><meta property="articleSection" content="Redis,数据库"></span><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag2 clickable" role="navigation">NoSql</span></li><li><span class="tag tag6 clickable" role="navigation">非关系型数据库</span></li><li><span class="tag tag3 clickable" role="navigation">高并发</span></li></ul><meta property="keywords" content="NoSql,非关系型数据库,高并发"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 6 分钟</span><meta property="timeRequired" content="PT6M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#一、官方资料" class="router-link-active router-link-exact-active toc-link level2">一、官方资料</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-rdb-redis-database" class="router-link-active router-link-exact-active toc-link level3">1. RDB（Redis DataBase）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-aof-append-only-file" class="router-link-active router-link-exact-active toc-link level3">2.AOF  (Append Only File)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-小结" class="router-link-active router-link-exact-active toc-link level3">3. 小结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#二、rdb配置" class="router-link-active router-link-exact-active toc-link level2">二、RDB配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-修改默认rdb文件位置" class="router-link-active router-link-exact-active toc-link level3">1.修改默认rdb文件位置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-默认快照配置" class="router-link-active router-link-exact-active toc-link level3">2.默认快照配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-相关指令" class="router-link-active router-link-exact-active toc-link level3">3.相关指令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_4-其他配置项" class="router-link-active router-link-exact-active toc-link level3">4.其他配置项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_5-rdb备份及恢复" class="router-link-active router-link-exact-active toc-link level3">5.RDB备份及恢复</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_6-小结" class="router-link-active router-link-exact-active toc-link level3">6.小结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#三、aof" class="router-link-active router-link-exact-active toc-link level2">三、AOF</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_1-持久化流程" class="router-link-active router-link-exact-active toc-link level3">1.持久化流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_2-开启aof" class="router-link-active router-link-exact-active toc-link level3">2.开启AOF</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_3-aof异常恢复" class="router-link-active router-link-exact-active toc-link level3">3.AOF异常恢复</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/mynotes/codenotes/database/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96.html#_4-小结" class="router-link-active router-link-exact-active toc-link level3">4.小结</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="一、官方资料" tabindex="-1"><a class="header-anchor" href="#一、官方资料" aria-hidden="true">#</a> 一、官方资料</h2><p>在线文档 : [<a href="https://redis.io/topics/persistence" target="_blank" rel="noopener noreferrer">https://redis.io/topics/persistence<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>](在线文档 : <a href="https://redis.io/topics/persistence" target="_blank" rel="noopener noreferrer">https://redis.io/topics/persistence<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p><ul><li><strong>RDB</strong> (Redis Database): RDB persistence performs point-in-time snapshots of your dataset at specified intervals.</li><li><strong>AOF</strong> (Append Only File): AOF persistence logs every write operation received by the server. These operations can then be replayed again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself.</li><li><strong>No persistence</strong> : You can disable persistence completely. This is sometimes used when caching.</li><li><strong>RDB + AOF</strong> : You can also combine both AOF and RDB in the same instance.</li></ul><p>官方共列出了四种持久化方案</p><h3 id="_1-rdb-redis-database" tabindex="-1"><a class="header-anchor" href="#_1-rdb-redis-database" aria-hidden="true">#</a> 1. RDB（Redis DataBase）</h3><p>是指在指定的时间间隔内将内存中的数据集快照写入磁盘， 也就 Snapshot 快照，恢复时将快照文件读到内存</p><h3 id="_2-aof-append-only-file" tabindex="-1"><a class="header-anchor" href="#_2-aof-append-only-file" aria-hidden="true">#</a> 2.AOF (Append Only File)</h3><blockquote><p>以日志的形式来记录每个写操作(增量保存)，将 Redis 执行过的所有写指令记录下来(比如 set/del 操作会记录, 读操作 get 不记录)</p><p>只许追加文件但不可以改写文件</p><p>redis 启动之初会读取该文件重新构建数据</p><p>redis 重启后根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p></blockquote><h3 id="_3-小结" tabindex="-1"><a class="header-anchor" href="#_3-小结" aria-hidden="true">#</a> 3. 小结</h3><ol><li><p>整个过程中，主进程是不进行任何 IO 操作的，这就确保了极高的性能</p></li><li><p>如果需要进行大规模数据的恢复, 且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效</p></li><li><p>RDB 的缺点是最后一次持久化后的数据可能丢失</p><blockquote><p>如果你是正常关闭 Redis , 仍然会进行持久化, 不会造成数据丢失</p><p>如果是 Redis 异常终止/宕机, 就可能造成数据丢失</p></blockquote></li></ol><h2 id="二、rdb配置" tabindex="-1"><a class="header-anchor" href="#二、rdb配置" aria-hidden="true">#</a> 二、RDB配置</h2><h3 id="_1-修改默认rdb文件位置" tabindex="-1"><a class="header-anchor" href="#_1-修改默认rdb文件位置" aria-hidden="true">#</a> 1.修改默认rdb文件位置</h3><p>在 redis.conf 中配置文件名称, 默认为 dump.rdb</p><p><code># The filename where to dump the DB</code></p><p><code>dbfilename dump.rdb</code></p><p>rdb文件存储位置：默认为 Redis 启动时命令行所在的目录下</p><p>可以在redis.conf中修改rdb文件的保存路径：</p><p><img src="https://s2.loli.net/2023/01/30/RvJa29WtcULMiXT.png" alt="20230130120703"></p><h3 id="_2-默认快照配置" tabindex="-1"><a class="header-anchor" href="#_2-默认快照配置" aria-hidden="true">#</a> 2.默认快照配置</h3><p><code>save 60 10000</code>表示在60秒时间段，有10000个key变化就进行RDB备份</p><p>如何禁用快照：<code>save &quot;&quot;</code></p><p>如果没有开启save注释，那么在退出Redis时也会进行备份，更新dump.rdb文件---&gt;shutdown [NOSAVE | SAVE] (默认save)</p><p><img src="https://s2.loli.net/2023/02/01/kSD8VqspQPN7ldb.png" alt="20230201094723"></p><h3 id="_3-相关指令" tabindex="-1"><a class="header-anchor" href="#_3-相关指令" aria-hidden="true">#</a> 3.相关指令</h3><table><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td>save</td><td>save 时只管保存，其它不管，全部阻塞。手动保存, 不建议</td></tr><tr><td>bgsave</td><td>Redis 会在后台异步进行快照操作， 快照同时还可以响应客户端请求</td></tr><tr><td>lastsave</td><td>获取最后一次成功执行快照的时间(unix 时间戳),转换网址：<a href="https://tool.lu/timestamp/" target="_blank" rel="noopener noreferrer">https://tool.lu/timestamp/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>flushall</td><td>用于清空整个 Redis 服务器的数据(删除所有数据库的所有 key),也会产生 dump.rdb 文件, 数据为空</td></tr><tr><td>redis-cli config set save &quot;&quot;</td><td>动态停止 RDB，save 后给空值，表示禁用保存策略</td></tr></tbody></table><h3 id="_4-其他配置项" tabindex="-1"><a class="header-anchor" href="#_4-其他配置项" aria-hidden="true">#</a> 4.其他配置项</h3><table><thead><tr><th>配置</th><th>说明</th></tr></thead><tbody><tr><td>stop-writes-on-bgsave-error</td><td>当 Redis 无法写入磁盘的话(比如磁盘满了), 直接关掉 Redis 的写操作。推荐 yes</td></tr><tr><td>rdbcompression</td><td>对于存储到磁盘中的快照，可以设置是否进行压缩存储。<br>如果是的话，redis 会采用LZF算法进行压缩，默认yes</td></tr><tr><td>rdbchecksum</td><td>在存储快照后, 还可以让 redis 使用 CRC64 算法来进行数据校验，保证文件是完整的。<br>这样做会增加大约 10%的性能消耗，推荐yes</td></tr></tbody></table><h3 id="_5-rdb备份及恢复" tabindex="-1"><a class="header-anchor" href="#_5-rdb备份及恢复" aria-hidden="true">#</a> 5.RDB备份及恢复</h3><ul><li>Redis 可以充当缓存, 对项目进行优化, 因此重要/敏感的数据建议在 Mysql要保存一份</li><li>从设计层面来说, Redis 的内存数据, 都是可以重新获取的(可能来自程序, 也可能来自Mysql)</li><li>Redis 启动时, 初始化数据是从dump.rdb 来的</li></ul><p>a. config get dir 查询 rdb 文件的目录</p><p>b. 将 dump.rdb 进行备份, 如果有必要可以写 shell 脚本来定时备份</p><h3 id="_6-小结" tabindex="-1"><a class="header-anchor" href="#_6-小结" aria-hidden="true">#</a> 6.小结</h3><p>a. 优势</p><p>1、适合大规模的数据恢复 2、对数据完整性和一致性要求不高更适合使用 3、节省磁盘空间 4、恢复速度快</p><p>b. 劣势</p><p>1、虽然 Redis 在 fork 时使用了写时拷贝技术(Copy-On-Write),但是如果数据庞大时还是比较消耗性能。</p><p>2、在备份周期在一定间隔时间做一次备份，所以如果 Redis 意外 down 掉的话(如果正常关闭 Redis, 仍然会进行 RDB 备份, 不会丢失数据), 就会丢失最后一次快照后的所有修改</p><h2 id="三、aof" tabindex="-1"><a class="header-anchor" href="#三、aof" aria-hidden="true">#</a> 三、AOF</h2><h3 id="_1-持久化流程" tabindex="-1"><a class="header-anchor" href="#_1-持久化流程" aria-hidden="true">#</a> 1.持久化流程</h3><ol><li><p>客户端的请求写命令会被 <code>append</code> 追加到 <code>AOF 缓冲区</code> 内</p></li><li><p>AOF 缓冲区根据 <code>AOF 持久化策略</code> [always,everysec,no]将操作 sync 同步到磁盘的 <code>AOF 文件</code> 中</p><blockquote><p>AOF频率设置</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>appendfsync everysec <span class="token comment"># 每秒进行一次同步，显示的将多个写命令同步到硬盘</span>
appendfsync always <span class="token comment"># 每个redis写命令都同步的写入磁盘，这样做会严重降低redis的速度</span>
appendfsync no <span class="token comment"># 由操作系统决定应该何时进行同步</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>AOF 文件大小超过重写策略或手动重写时，会对 AOF 文件 <code>rewrite</code> 重写，压缩 AOF 文件容量</p><blockquote><p>AOF文件手动重写</p></blockquote><p>可以向redis发送 <code>bgrewriteaof</code>，这个命令会移除在文件中的冗余命令来重写rewriteAOF文件，使AOF文件的体积变得尽可能的小</p><p>还需要注意的是，当AOF文件过大，在重写过程以及重写完成之后删除旧有AOF文件，删除一个较大的AOF文件还可能会导致操作系统挂起数秒</p><blockquote><p>AOF文件自动重写策略</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>auto-aof-rewrite-percentage <span class="token number">100</span>
auto-aof-rewrite-min-size 64mb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上述选项的含义：当AOF文件此时大于64M，并且AOF文件的体积比上一次重写之后的体积大于了至少一倍100%，那么redis就会执行 <code>BGREWRITEAOF</code>命令</p></li><li><p>Redis 服务重启时，会重新 <code>load</code> 加载 AOF 文件中的写操作达到数据恢复目的</p></li></ol><h3 id="_2-开启aof" tabindex="-1"><a class="header-anchor" href="#_2-开启aof" aria-hidden="true">#</a> 2.开启AOF</h3><ul><li>在 redis.conf 中配置文件名称，默认为 appendonly.aof,需要开启appendonly选项，默认为no</li><li>AOF 文件的保存路径，同 RDB 的路径一致</li><li>AOF 和 RDB 同时开启，系统默认读取 AOF 的数据</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1253</span> appendonly <span class="token function">yes</span>
<span class="token number">1254</span>
<span class="token number">1255</span> <span class="token comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span>
<span class="token number">1256</span>
<span class="token number">1257</span> appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-aof异常恢复" tabindex="-1"><a class="header-anchor" href="#_3-aof异常恢复" aria-hidden="true">#</a> 3.AOF异常恢复</h3><ul><li>如遇到 AOF 文件损坏，通过/usr/local/bin/redis-check-aof --fix appendonly.aof 进行恢复</li><li>建议先: 备份被写坏的 AOF 文件</li><li>恢复：重启 redis，然后重新加载</li></ul><h3 id="_4-小结" tabindex="-1"><a class="header-anchor" href="#_4-小结" aria-hidden="true">#</a> 4.小结</h3><p>a. 优势</p><p>1、备份机制更稳健，丢失数据概率更低。</p><p>2、可读的日志文本，通过操作 AOF 稳健，可以处理误操作</p><p>b. 劣势</p><p>1、比起 RDB 占用更多的磁盘空间</p><p>2、恢复备份速度要慢</p><p>3、每次读写都同步的话，有一定的性能压力</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/mynotes/codenotes/database/Redis/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html" class="nav-link prev" aria-label="Redis发布订阅"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><span class="icon iconfont icon-workingDirectory"></span>Redis发布订阅</div></a><a href="/mynotes/codenotes/database/Redis/Redis%E4%BA%8B%E5%8A%A1.html" class="nav-link next" aria-label="Redis事务"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Redis事务<span class="icon iconfont icon-workingDirectory"></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/mynotes/assets/app.072b1c63.js" defer></script>
  </body>
</html>
